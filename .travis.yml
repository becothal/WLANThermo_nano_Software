# Continuous Integration (CI) is the practice, in software
# engineering, of merging all developer working copies with a shared mainline
# several times a day < https://docs.platformio.org/page/ci/index.html >
#
# Documentation:
#
# * Travis CI Embedded Builds with PlatformIO
#   < https://docs.travis-ci.com/user/integration/platformio/ >
#
# * PlatformIO integration with Travis CI
#   < https://docs.platformio.org/page/ci/travis.html >
#
# * User Guide for `platformio ci` command
#   < https://docs.platformio.org/page/userguide/cmd_ci.html >
#
#

 language: python
 python:
     - "2.7"

 sudo: false
 cache:
     directories:
         - "~/.platformio"
 git:
    depth: 3
 notifications:
    slack:
        secure: vXe39dh3wtwXlWll+N8UAhQjWS6WlDal4dpQn7HTTH8yEDKnSFGhSTWzChG3oj8BRJgtU7VG6mBgbyyVo0SApwSC0Lo4j7kdiLTbsCgWotP7bm9mYRu5v+Q1K/GeOp2nSmgotx9nPO1Z/YO8Qehtb2n2G9N0h5ns7eH/TIE1tvsgKdWFbvPVClemuXJW46tHEa4mqyiMMQSWVJqLaj7WY8X3Mm5Qls9w6S91zzkz93Lf0sg0LzDHF/iY9Tc4AGDNQgHPcYYFm3qTwtjHFWGIb6Z5XaB1JGtcCxlHNb+t8i8B6T+CXp5M5E/+DiNGuAAElV4mrXmfNRb0ErtfIgXriqGkceO8SFIDJVY3OYEHCpO4lI5tqCgebYDtwG3//miHgBGHuk/r4eZ10Xrxckk58Nq8+WAzDl4rId09QNDExIJddCclEmo7TBwwiOn3kPKHtGSeU1e+aEUtmWif3EOReQzdDB3Im6QEy2SlLTGtU0xy2XoWXDh7b3bc21dDVMd5t52RAYY2lAAgLzdTAAZZ4vYdUpgJYmc2qTyBizTkUj8joB7fgtGxPvmO7SEKqzDQprrcQ9GugNTaxPVcsr1a/6tIKDWbmFMrV5clluaOsqi07dqirANMAGvPviHUcs88906327OwX5JQzN3kSS/q5vjJ84571pd1RDxxYVX6oog=
        on_success: always
        on_failure: always
 jobs:
     include:
        - name: build
          stage: build
          if: branch = develop
          install:
              - pip install -U platformio
              - platformio update

          before_script:
              - gzip ./data_source/data/index.html
              - mv ./data_source/data/index.html.gz ./data/index.html.gz
              - mv ./data_source/data/nano.ttf ./data/nano.ttf 

          script:
              - platformio run && platformio run --target buildfs 


        - name: beta_build
          stage: build
          if: branch =~ ^(beta).*v[0-9]\..*
          install:
              - pip install -U platformio
              - platformio update

          before_script:
              - gzip ./data_source/data/index.html
              - mv ./data_source/data/index.html.gz ./data/index.html.gz
              - mv ./data_source/data/nano.ttf ./data/nano.ttf 

          script:
              - platformio run && platformio run --target buildfs 
          deploy:
            provider: releases
            file:
                - ./.pioenvs/esp8285/firmware.bin
                - ./.pioenvs/esp8285/spiffs.bin
            skip_cleanup: true
            prerelease: true
            api_key:
                secure: gx0NhBm/7UXo7Zql79z5yV3IMRc7VyL8kYyS9RXPWTo9ZOh3ZOIU706yvw83oxc8L6jxmKX/u9kJ102jNDM8Tg/o4qfdz4BBkyWBzamHyqjNX851WsjcIpPtFcyZc1bXRn8zPjXrtmNtgnUsvRVJjtSyyTeFVcqTdC243rKXwr7b8jy9YX4CuJnCy+UgZ1swHZRo1OyEWEYJe93tEBTQGN6WfrogBfQDPB8eLihheS6KUVGfBRMds7puCUMubBYlX/4tuyyB85I038ZGbqHEEGFvFa2y+zlOA5NS4FEhG+NV81kBIuF1Hj+KCSInxmjgWijVOtbsgZnIeFC+hKR5f8etvWStdtNAaxHpWu8qRS5mB5eVNzpvh1lgY3DxMLPHjdG20XB/inOIS7X0DO0rhHolGNgfmHOZyNf6IFy8VEHaz6NBJ7uNyfAVs536Qssk97vUXvNC/dbvxXogGUDeKnkQ/IgTT4Re0o4LrfGMs0WyXP+GlwCCiCMCArGHle/3x9CYSOgUgZ6F9mcogOJbv6rVZ5wChV0EbjoZJpjowUTXe5EHSE2tIllkybP0lEYZv745D+WlCGxjwczRPFoRL3BwKlFZ4q9a8mkmSJcdhZt0lQk0CouLH/qs/zFtBUuO+LgDf/pD7nbZDqBQyv9CNb+4f3oF5gJ2eIe1DYnk+4U=
            on: 
                all_branches: true
                repo: becothal/WLANThermo_nano_Software



        - name: release_build
          stage: build
          if: branch =~ ^v[0-9]\.[0-9]*
          install:
              - pip install -U platformio
              - platformio update

          before_script:
              - gzip ./data_source/data/index.html
              - mv ./data_source/data/index.html.gz ./data/index.html.gz
              - mv ./data_source/data/nano.ttf ./data/nano.ttf 

          script:
              - platformio run && platformio run --target buildfs 
          deploy:
            provider: releases
            file:
                - ./.pioenvs/esp8285/firmware.bin
                - ./.pioenvs/esp8285/spiffs.bin
            skip_cleanup: true
            prerelease: false
            api_key:
                secure: gx0NhBm/7UXo7Zql79z5yV3IMRc7VyL8kYyS9RXPWTo9ZOh3ZOIU706yvw83oxc8L6jxmKX/u9kJ102jNDM8Tg/o4qfdz4BBkyWBzamHyqjNX851WsjcIpPtFcyZc1bXRn8zPjXrtmNtgnUsvRVJjtSyyTeFVcqTdC243rKXwr7b8jy9YX4CuJnCy+UgZ1swHZRo1OyEWEYJe93tEBTQGN6WfrogBfQDPB8eLihheS6KUVGfBRMds7puCUMubBYlX/4tuyyB85I038ZGbqHEEGFvFa2y+zlOA5NS4FEhG+NV81kBIuF1Hj+KCSInxmjgWijVOtbsgZnIeFC+hKR5f8etvWStdtNAaxHpWu8qRS5mB5eVNzpvh1lgY3DxMLPHjdG20XB/inOIS7X0DO0rhHolGNgfmHOZyNf6IFy8VEHaz6NBJ7uNyfAVs536Qssk97vUXvNC/dbvxXogGUDeKnkQ/IgTT4Re0o4LrfGMs0WyXP+GlwCCiCMCArGHle/3x9CYSOgUgZ6F9mcogOJbv6rVZ5wChV0EbjoZJpjowUTXe5EHSE2tIllkybP0lEYZv745D+WlCGxjwczRPFoRL3BwKlFZ4q9a8mkmSJcdhZt0lQk0CouLH/qs/zFtBUuO+LgDf/pD7nbZDqBQyv9CNb+4f3oF5gJ2eIe1DYnk+4U=
            on: 
                all_branches: true
                repo: becothal/WLANThermo_nano_Software
